name: Compatibility Check
on:
  workflow_dispatch:
    inputs:
      dependencyMavenCoordinates:
        description: 'The Maven coordinates of the dependency to check'
        required: true
        type: string
jobs:
  compatibility-check:
    runs-on: ubuntu-latest
    steps:
    - name: Print the input variables
      run: |
        echo "dependencyMavenCoordinates: ${{ github.event.inputs.dependencyMavenCoordinates }}"
    - uses: actions/checkout@v2
    - name: Show git commit log of the specified branch
      run: git log -1
    - uses: stCarolas/setup-maven@v4
      with:
        maven-version: 3.8.1
    - uses: actions/setup-java@v1
      with:
        java-version: 8
    - run: java -version
    - uses: GoogleCloudPlatform/cloud-opensource-java/dependency-update@github_action_dependency_updator
      with:
        mavenCoordinates: ${{ github.event.inputs.dependencyMavenCoordinates }}
    - name: Showing code diff after version update
      run: |
        git diff
      shell: bash
    - run: .kokoro/build.sh
      env:
        JOB_TYPE: test