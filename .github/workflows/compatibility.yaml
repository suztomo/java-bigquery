name: Compatibility Check
on:
  workflow_dispatch:
    inputs:
      baseBranch:
        description: 'Base branch'
        required: true
        type: string
      dependencyMavenCoordinates:
        description: 'The Maven coordinates of the dependency to check'
        required: true
        type: string
jobs:
  compatibility-check:
    runs-on: ubuntu-latest
    steps:
    - name: Print the input variables
      run: |
        echo "baseBranch: ${{ github.event.inputs.baseBranch }}"
        echo "dependencyMavenCoordinates: ${{ github.event.inputs.dependencyMavenCoordinates }}"
    - uses: actions/checkout@v2
      with:
        ref: ${{ github.event.inputs.baseBranch }}
    - uses: stCarolas/setup-maven@v4
      with:
        maven-version: 3.8.1
    - uses: actions/setup-java@v1
      with:
        java-version: 8
    - run: java -version
    - name: Update pom.xml to use the specified dependencies
      run: |
        ./kokoro/compatibility-pom-updater.sh ${{ github.event.inputs.dependencyMavenCoordinates }}
    - run: .kokoro/build.sh
      env:
        JOB_TYPE: test